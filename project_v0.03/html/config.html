<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –†—É–ª–µ—Ç–∫–∏</title>
  <link rel="stylesheet" href="../css/panel.css">
  <link rel="stylesheet" href="../css/config.css">
  <style>
    body {
      display: flex;
      justify-content: space-between;
      padding: 20px;
    }
    .settings-container {
      width: 60%;
    }
    .roulette-preview-container {
      width: 35%;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      background-color: #2e2e2e;
      color: #fff;
    }
    .preview-image-container {
      position: relative;
      display: inline-block;
      width: 80px;
      height: 80px;
      margin: 5px;
    }
    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .delete-image-button {
      position: absolute;
      top: 2px;
      right: 2px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .slot-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
    }
    .modal img {
      position: absolute;
      cursor: grab;
      transform-origin: center center;
    }
    .modal img:active {
      cursor: grabbing;
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –†—É–ª–µ—Ç–∫–∏ üé∞</h1>

    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-name">–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–∞:</label>
      <input type="text" id="roulette-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" value="–ë–∞—Ä–∞–±–∞–Ω –∫–∞–∑–∏–Ω–æ">
    </div>

    <!-- –°–ª–æ–≤–∞ –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-words">–°–ª–æ–≤–∞ –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
      <textarea id="roulette-words" placeholder="–°–ª–æ–≤–æ1, –°–ª–æ–≤–æ2, –°–ª–æ–≤–æ3">–í–æ–∏–Ω, –ú–∞–≥, –ê—Å—Å–∞—Å–∏–Ω</textarea>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-images">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞:</label>
      <input type="file" id="roulette-images" multiple accept="image/*">
      <div id="image-preview-container">
        <h3>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</h3>
        <div id="preview-list" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
      </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–≤–æ–¥–∫–∏ –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-border-color">–¶–≤–µ—Ç –æ–±–≤–æ–¥–∫–∏:</label>
      <input type="color" id="roulette-border-color" value="#9146FF">
      <label for="roulette-border-width">–¢–æ–ª—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏ (px):</label>
      <input type="number" id="roulette-border-width" min="1" max="10" value="5">
    </div>

    <button id="save-settings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>

  <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä—É–ª–µ—Ç–∫–∏ -->
  <div class="roulette-preview-container">
    <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä—É–ª–µ—Ç–∫–∏</h2>
    <div class="slot-machine-container" id="slot-machine-preview">
      <div class="indicator"></div>
      <div class="slot-items" id="slot-items-preview">
        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã —Ä—É–ª–µ—Ç–∫–∏ -->
      </div>
    </div>
    <div class="result" id="result-preview">üéâ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
  </div>

  <!-- Modal for Image Transformation -->
  <div id="image-modal" class="modal">
    <img id="modal-image" src="" alt="Transformed Image">
  </div>

  <script>
    const imageInput = document.getElementById('roulette-images');
    const previewList = document.getElementById('preview-list');
    const uploadedImages = new Set();
    const modal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    const rouletteWordsInput = document.getElementById('roulette-words');
    const slotItemsPreview = document.getElementById('slot-items-preview');
    const rouletteBorderColorInput = document.getElementById('roulette-border-color');
    const rouletteBorderWidthInput = document.getElementById('roulette-border-width');
    const slotMachinePreview = document.getElementById('slot-machine-preview');
    const rouletteItems = [];

    let isDragging = false;
    let scale = 1; // –ù–∞—á–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    let startX, startY; // –ù–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º—ã—à–∏
    let imgStartX, imgStartY; // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä—É–ª–µ—Ç–∫–∏
    function updateRoulettePreview() {
      slotItemsPreview.innerHTML = '';
      const words = rouletteWordsInput.value.split(',').map(word => word.trim()).filter(word => word);
      const items = [...rouletteItems, ...words.map(word => ({ type: 'word', data: word }))];

      items.forEach(item => {
        const slotItem = document.createElement('div');
        slotItem.className = 'slot-item';

        if (item.type === 'image') {
          const img = document.createElement('img');
          img.src = item.data;
          slotItem.appendChild(img);
        } else if (item.type === 'word') {
          slotItem.textContent = item.data;
        }

        slotItemsPreview.appendChild(slotItem);
      });

      // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±–≤–æ–¥–∫–∏ —Ä—É–ª–µ—Ç–∫–∏
      applyRouletteBorder();
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±–≤–æ–¥–∫–∏ —Ä—É–ª–µ—Ç–∫–∏
    function applyRouletteBorder() {
      const borderColor = rouletteBorderColorInput.value;
      const borderWidth = rouletteBorderWidthInput.value;

      slotMachinePreview.style.border = `${borderWidth}px solid ${borderColor}`;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–≤–æ–¥–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    rouletteBorderColorInput.addEventListener('input', applyRouletteBorder);
    rouletteBorderWidthInput.addEventListener('input', applyRouletteBorder);

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function openModal(imageSrc) {
      const slotItem = document.querySelector('.slot-item'); // –ë–µ—Ä–µ–º —Ä–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ –±–∞—Ä–∞–±–∞–Ω–∞
      const rect = slotItem.getBoundingClientRect();
      modal.style.width = `${rect.width * 2}px`; // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ –æ–∫–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
      modal.style.height = `${rect.height * 2}px`; // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ –æ–∫–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
      modalImage.src = imageSrc;
      modal.style.display = 'block';
      scale = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
      modalImage.style.transform = `scale(${scale})`;
      modalImage.style.left = "0px";
      modalImage.style.top = "0px";
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('mousedown', (event) => {
      if (isDragging) return; // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      if (modal.style.display === 'block' && !modal.contains(event.target)) {
        modal.style.display = 'none';
      }
    });

    // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    modalImage.addEventListener('mousedown', (event) => {
      isDragging = true;
      startX = event.clientX;
      startY = event.clientY;
      imgStartX = parseFloat(modalImage.style.left || 0);
      imgStartY = parseFloat(modalImage.style.top || 0);
      event.preventDefault(); // –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏
    });

    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    document.addEventListener('mousemove', (event) => {
      if (!isDragging) return;

      const deltaX = (event.clientX - startX) / scale; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–±
      const deltaY = (event.clientY - startY) / scale; // –£—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Å—à—Ç–∞–±

      const newLeft = imgStartX + deltaX;
      const newTop = imgStartY + deltaY;

      modalImage.style.left = `${newLeft}px`;
      modalImage.style.top = `${newTop}px`;
    });

    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
    document.addEventListener('mouseup', () => {
      isDragging = false;
    });

    // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
    modal.addEventListener('wheel', (event) => {
      event.preventDefault(); // –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const zoomStep = 0.1; // –®–∞–≥ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
      scale += event.deltaY < 0 ? zoomStep : -zoomStep; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–ª–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞
      scale = Math.min(Math.max(scale, 0.5), 3); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± (–º–∏–Ω–∏–º—É–º: 0.5, –º–∞–∫—Å–∏–º—É–º: 3)
      modalImage.style.transform = `scale(${scale})`;
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    imageInput.addEventListener('change', (event) => {
      Array.from(event.target.files).forEach((file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          if (uploadedImages.has(e.target.result)) {
            alert('–≠—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
            return;
          }
          uploadedImages.add(e.target.result);
          rouletteItems.push({ type: 'image', data: e.target.result });

          const imgContainer = document.createElement('div');
          imgContainer.className = 'preview-image-container';

          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = 'Image';
          img.className = 'preview-image';
          img.addEventListener('dblclick', () => openModal(e.target.result));
          imgContainer.appendChild(img);

          const deleteButton = document.createElement('button');
          deleteButton.className = 'delete-image-button';
          deleteButton.textContent = '√ó';
          deleteButton.addEventListener('click', () => {
            uploadedImages.delete(e.target.result);
            rouletteItems.splice(rouletteItems.findIndex(item => item.data === e.target.result), 1);
            previewList.removeChild(imgContainer);
            updateRoulettePreview();
          });

          imgContainer.appendChild(deleteButton);
          previewList.appendChild(imgContainer);
          updateRoulettePreview();
        };
        reader.readAsDataURL(file);
      });
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateRoulettePreview();
  </script>
</body>
</html>