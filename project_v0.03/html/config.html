<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –†—É–ª–µ—Ç–∫–∏</title>
  <link rel="stylesheet" href="../css/panel.css">
  <link rel="stylesheet" href="../css/config.css">
  <style>
    body {
      display: flex;
      justify-content: space-between;
      padding: 20px;
      background-color: #2e2e2e;
      color: #fff;
    }
    .settings-container {
      width: 60%;
    }
    .roulette-preview-container {
      width: 35%;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      background-color: #2e2e2e;
      color: #fff;
      position: relative;
    }
    .central-slot {
      width: 200px;
      height: 200px;
      border: 2px solid #9146FF;
      margin: 20px auto;
      position: relative;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .transformation-hitbox {
      position: absolute;
      border: 2px dashed #fff;
      resize: both;
      overflow: hidden;
      user-select: none;
      z-index: 100;
      cursor: move;
    }
    .transformation-hitbox img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .preview-image-container {
      position: relative;
      display: inline-block;
      width: 80px;
      height: 80px;
      margin: 5px;
    }
    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .delete-image-button {
      position: absolute;
      top: 2px;
      right: 2px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –†—É–ª–µ—Ç–∫–∏ üé∞</h1>

    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-name">–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–∞:</label>
      <input type="text" id="roulette-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" value="–ë–∞—Ä–∞–±–∞–Ω –∫–∞–∑–∏–Ω–æ">
    </div>

    <!-- –°–ª–æ–≤–∞ –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-words">–°–ª–æ–≤–∞ –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
      <textarea id="roulette-words" placeholder="–°–ª–æ–≤–æ1, –°–ª–æ–≤–æ2, –°–ª–æ–≤–æ3">–í–æ–∏–Ω, –ú–∞–≥, –ê—Å—Å–∞—Å–∏–Ω</textarea>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞ -->
    <div>
      <label for="roulette-images">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –±–∞—Ä–∞–±–∞–Ω–∞:</label>
      <input type="file" id="roulette-images" multiple accept="image/*">
      <div id="image-preview-container">
        <h3>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</h3>
        <div id="preview-list" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
      </div>
    </div>

    <button id="save-settings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>

  <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä—É–ª–µ—Ç–∫–∏ -->
  <div class="roulette-preview-container">
    <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä—É–ª–µ—Ç–∫–∏</h2>
    <div class="central-slot" id="central-slot"></div>
    <div class="slot-machine-container" id="slot-machine-preview">
      <div class="slot-items" id="slot-items-preview"></div>
    </div>
  </div>

  <script>
    const imageInput = document.getElementById('roulette-images');
    const previewList = document.getElementById('preview-list');
    const centralSlot = document.getElementById('central-slot');
    const uploadedImages = new Set();
    let activeImageSrc = null;
    let transformationHitbox = null;

    // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    imageInput.addEventListener('change', (event) => {
      Array.from(event.target.files).forEach((file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          if (uploadedImages.has(e.target.result)) {
            alert('–≠—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
            return;
          }
          uploadedImages.add(e.target.result);

          const imgContainer = document.createElement('div');
          imgContainer.className = 'preview-image-container';

          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = 'Image';
          img.className = 'preview-image';
          img.addEventListener('dblclick', () => {
            activateTransformationMode(img.src);
          });
          imgContainer.appendChild(img);

          const deleteButton = document.createElement('button');
          deleteButton.className = 'delete-image-button';
          deleteButton.textContent = '√ó';
          deleteButton.addEventListener('click', () => {
            uploadedImages.delete(e.target.result);
            previewList.removeChild(imgContainer);
          });

          imgContainer.appendChild(deleteButton);
          previewList.appendChild(imgContainer);
        };
        reader.readAsDataURL(file);
      });
    });

    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
    function activateTransformationMode(imageSrc) {
      if (transformationHitbox) return; // –ï—Å–ª–∏ —Ä–µ–∂–∏–º —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º

      activeImageSrc = imageSrc;

      transformationHitbox = document.createElement('div');
      transformationHitbox.className = 'transformation-hitbox';
      transformationHitbox.style.width = '150px';
      transformationHitbox.style.height = '150px';
      transformationHitbox.style.position = 'absolute';
      transformationHitbox.style.top = '25px'; // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
      transformationHitbox.style.left = '25px'; // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

      const img = document.createElement('img');
      img.src = imageSrc;
      img.alt = 'Transforming Image';
      transformationHitbox.appendChild(img);

      transformationHitbox.addEventListener('mousedown', startDragging);

      centralSlot.appendChild(transformationHitbox);

      document.addEventListener('click', handleOutsideClick);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –≤–Ω–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —è—á–µ–π–∫–∏
    function handleOutsideClick(event) {
      if (
        !centralSlot.contains(event.target) &&
        !previewList.contains(event.target)
      ) {
        endTransformationMode();
        document.removeEventListener('click', handleOutsideClick);
      }
    }

    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
    function endTransformationMode() {
      if (transformationHitbox) {
        transformationHitbox.remove();
        transformationHitbox = null;
        activeImageSrc = null;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–∞
    function startDragging(event) {
      const hitbox = event.currentTarget;
      let shiftX = event.clientX - hitbox.getBoundingClientRect().left;
      let shiftY = event.clientY - hitbox.getBoundingClientRect().top;

      function moveAt(pageX, pageY) {
        hitbox.style.left = pageX - shiftX + 'px';
        hitbox.style.top = pageY - shiftY + 'px';
      }

      function onMouseMove(event) {
        moveAt(event.pageX, event.pageY);
      }

      document.addEventListener('mousemove', onMouseMove);

      document.addEventListener('mouseup', () => {
        document.removeEventListener('mousemove', onMouseMove);
      }, { once: true });
    }
  </script>
</body>
</html>